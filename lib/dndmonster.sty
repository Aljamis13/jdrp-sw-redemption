% Monster environment sty file
\usepackage{fp}

% Macro to print stats with autocomputed modifier
% e.g. \stat{12} prints "12 (+1)"
\newcommand{\stat}[1]{%
   \FPeval{\mod}{(#1 - 6)}%
   \FPifzero\mod%
   \FPeval{\mod}{clip(trunc(mod,0))}D#1%
   \else%
   \FPeval{\mod}{clip(trunc(mod,0))}D#1 (+\mod)%
   \fi%
}

% Monster box made to look like the Monster Manual NPC definitions
\newtcolorbox{monsterboxnobg}[2][]{
   enhanced,
   frame hidden,
   before skip=7pt plus2pt,
   boxrule=0pt,
   breakable,
   boxsep=0.25ex,
   toptitle=3mm,
   left=2.5mm,
   right=2.15mm,
   arc=0mm,
   opacityback=0,
   colframe=titlered,
   fonttitle=\scshape\bfseries\color{titlered}\Large,
   fontupper=\fontfamily{lmss}\selectfont,
   title=#2,
   after={\vspace{7pt plus 1pt}\noindent},
   #1
}

% new Monsterbox
\newtcolorbox{monsterbox}[2][]{
	enhanced,
	frame hidden,
	before skip=7pt plus2pt,
	boxrule=0pt,
	breakable,
	boxsep=0.25ex,
	toptitle=3mm,
	left=2.5mm,
	right=2.15mm,
	arc=0mm,
	borderline north={4pt}{0pt}{titlered},
	borderline north={2.5pt}{0.75pt}{puregold},
	borderline south={4pt}{0pt}{titlered},
	borderline south={2.5pt}{0.75pt}{puregold},
	colback=monstertan,
	colbacktitle=monstertan,
	colframe=titlered,
	fonttitle=\scshape\bfseries\color{titlered}\Large,
	fontupper=\fontfamily{lmss}\selectfont,
	title=#2,
	after={\vspace{7pt plus 1pt}\noindent},
	#1
}


% Define Monster subsection header style
%\newcommand{\monstersection}[1]{\subsubsection*{#1}}
\newcommand{\monstersection}[1]{
	{\par
	\color{titlered}\normalfont\scshape\Large #1 \vspace{3pt}
	\titleline{\color{titlered}\titlerule[0.6pt]}
	\par\medskip}
	}
%\titlespacing*{\subsubsection}{0pt}{*0.5}{5pt}
%\titleformat{\subsubsection}
%{\color{titlered}\normalfont\scshape\Large}{\thesubsection}{1em}{}[{\color{titlered}\titlerule[0.5pt]\color{black}}]

\newenvironment{monsteraction}[1][\unskip]{\emph{\textbf{#1.}}}{\vspace{0.5em}}

%
% Macros for use within the monster environment
%
\newkeycommand\basics[type=0, planet=0, language=0]{%
	\color{titlered}
	\textbf{Type} \commandkey{type}\\
  \textbf{Planète} \commandkey{planet}\\
	\textbf{Langage} \commandkey{language}\\
}

% Taubular enviornment for stats-block
\newkeycommand\traits[AGI=\stat{6},
                        AME=\stat{6},
                        FOR=\stat{6},
                        INT=\stat{6},
                        VIG=\stat{6}]{
    {
    \vspace{-10pt}
	\begin{center}
    \begin{tabular*}{0.95\linewidth}{c @{\extracolsep{\fill}} cccc}
			\textbf{AGI} & \textbf{AME} & \textbf{FOR} & \textbf{INT} & \textbf{VIG}\\
			\commandkey{AGI} & \commandkey{AME} & \commandkey{FOR} & \commandkey{INT} & \commandkey{VIG}
		\end{tabular*}
	\end{center}
  }
}

\newkeycommand\stats[ALL=6,
                        PAR=2, % 2 + 0,5 x la compétence de combat arrondie à l'inférieur (d12+1 en combat = 8)
                        RES=4,
                        CHA=3]{ % 2 + 0,5 x VIG
  {
    \vspace{-10pt}
    \begin{center}
      \begin{tabular*}{0.85\linewidth}{c @{\extracolsep{\fill}} cccc}
        \textbf{ALL} & \textbf{PAR} & \textbf{RES} & \textbf{CHA} & \textbf{}\\
        \commandkey{ALL} & \commandkey{PAR} & \commandkey{RES} & \commandkey{CHA} & \textbf{}
      \end{tabular*}
    \end{center}
  }
}

\newkeycommand\details[skills=,
                      damageimmunities=,
                      savingthrows=,
                      conditionimmunities=,
                      damageresistances=,
                      damagevulnerabilities=,
                      senses=,
                      size=,
                      challenge=]{%
  \ifcommandkey{savingthrows}
    {\textbf{Saving Throws} \commandkey{savingthrows}\\}{}
  \ifcommandkey{skills}
    {\textbf{Skills} \commandkey{skills}\\}{}
  \ifcommandkey{damagevulnerabilities}
    {\textbf{Damage Vulnerabilities} \commandkey{damagevulnerabilities}\\}{}
  \ifcommandkey{damageresistances}
    {\textbf{Damage Resistances} \commandkey{damageresistances}\\}{}
  \ifcommandkey{damageimmunities}
    {\textbf{Damage Immunities} \commandkey{damageimmunities}\\}{}
  \ifcommandkey{conditionimmunities}
    {\textbf{Condition Immunities} \commandkey{conditionimmunities}\\}{}
  % These traits appear to always be present.
  \ifcommandkey{senses}
    {\textbf{Senses} \commandkey{senses}\\}{}
  \ifcommandkey{size}
    {\textbf{Taille} \commandkey{size}\\}{}
  \ifcommandkey{challenge}
    {\textbf{Challenge} \commandkey{challenge}\\}{}
\color{black}
}
